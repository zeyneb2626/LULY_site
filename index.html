<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>Configurateur Tradi‚Äôhome</title>
  <!-- importer model-viewer -->
  <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>
  <style>
    body { font-family: sans-serif; margin: 0; padding: 0; }
    #configurator { display: flex; height: 100vh; }
    .viewer { flex: 1; }
    .features { width: 300px; padding: 1rem; box-sizing: border-box; overflow-y: auto; }
    .group { margin-bottom: 1.5rem; }
    .group h4 { margin: .5rem 0; }
    .group button { display: block; width: 100%; margin-bottom: .5rem; padding: .5rem; border: 1px solid #ccc; background: #fff; cursor: pointer; text-align: left; }
    .group button.selected { border-color: #007aff; }
    #price { margin-top: 2rem; font-weight: bold; }
    #list-mats { margin-top: 2rem; padding: .5rem; width: 100%; }
  </style>
</head>
<body>
  <div id="configurator">
    <!-- zone 3D -->
    <div class="viewer">
      <model-viewer
        id="model"
        src="Tadi_home_draco3.glb"
        alt="Maison 3D"
        camera-controls
        auto-rotate
        background-color="#ffffff"
        style="width:100%; height:100%;">
      </model-viewer>
    </div>

    <!-- zone UI -->
    <div class="features">
      <!-- Exemples de groupes : adaptez / dupliquez -->
      <div class="group" data-cat="bardage">
        <h4>Bardage</h4>
        <button data-color="#ffffff" data-cost="0">Blanc (0 ‚Ç¨)</button>
        <button data-color="#8c6a4f" data-cost="799">Ch√™ne fonc√© (+799 ‚Ç¨)</button>
        <button data-color="#343a40" data-cost="899">Gris orage (+899 ‚Ç¨)</button>
      </div>

      <!-- √Ä vous de cr√©er les autres groupes : menuiserie, goutti√®re, pergola, peinture, toiture‚Ä¶ -->

      <p id="price">Prix total : 170 000 ‚Ç¨</p>
      <button id="list-mats">üìã Lister les mat√©riaux</button>
    </div>
  </div>

  <script type="module">
    document.addEventListener('DOMContentLoaded', () => {
      const mv      = document.getElementById('model');
      const priceEl = document.getElementById('price');
      const listBtn = document.getElementById('list-mats');
      const basePrice = 170000;
      const selection = {};

      // passe du hex au [r,g,b,a]
      function hexToRGBA(hex) {
        const v = parseInt(hex.slice(1), 16);
        return [(v >> 16 & 255)/255, (v >> 8 & 255)/255, (v & 255)/255, 1];
      }

      // matMap vide ‚Üí on remplira apr√®s listing
      const materialMap = {
        bardage:    [],
        menuiserie: [],
        gouttiere:  [],
        pergola:    [],
        peinture:   [],
        toiture:    []
      };

      // === 1) bouton pour lister les mat√©riaux dans la Console ===
      listBtn.addEventListener('click', () => {
        mv.addEventListener('load', () => {
          const mats = mv.model.materials;
          console.log('üîó Cl√© interne ‚Üí nom Blender :');
          Object.entries(mats).forEach(([key, mat]) =>
            console.log(`${key} ‚Üí ${mat.name}`)
          );
        }, { once: true });
        // force un re-chargement pour d√©clencher l‚Äô√©v√©nement
        mv.load();
      });

      // === 2) quand le mod√®le est charg√© la premi√®re fois ===
      mv.addEventListener('load', () => {
        const mats = mv.model.materials;
        // pour chaque groupe de boutons‚Ä¶
        document.querySelectorAll('.group').forEach(group => {
          const cat = group.dataset.cat;
          const buttons = group.querySelectorAll('button');

          buttons.forEach(btn => {
            btn.addEventListener('click', () => {
              // 2.1) visuel
              buttons.forEach(b => b.classList.remove('selected'));
              btn.classList.add('selected');

              // 2.2) calcul du prix
              selection[cat] = Number(btn.dataset.cost);
              const total = Object.values(selection).reduce((a,b)=>a+b, basePrice);
              priceEl.textContent = `Prix total : ${total.toLocaleString()} ‚Ç¨`;

              // 2.3) couleur
              const rgba = hexToRGBA(btn.dataset.color);
              (materialMap[cat]||[]).forEach(name => {
                const m = mats[name];
                if (m) {
                  m.pbrMetallicRoughness.setBaseColorFactor(rgba);
                } else {
                  console.warn(`‚ùå mat√©riau '${name}' pas trouv√©`);
                }
              });
            });
          });

          // auto-click 1·µâ bouton pour valeur par d√©faut
          if (buttons[0]) buttons[0].click();
        });
      });

    });
  </script>
</body>
</html>
