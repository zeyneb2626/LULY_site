<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Configurateur Tradi'home</title>
  <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>
  <style>
    body { margin:0; font-family: sans-serif; background: #f0f0f0; }
    #configurator { display: flex; max-width: 1200px; margin: auto; padding: 2rem; gap: 2rem; }
    .viewer { flex: 2; }
    model-viewer { width: 100%; height: 600px; background: #fff; border-radius: 8px; }
    #features { flex: 1; display: flex; flex-direction: column; gap: 1rem; }
    .group { background: #fff; border-radius: 8px; padding: 1rem; }
    .group h4 { margin: 0 0 .5rem; }
    .group button {
      display: block;
      width: 100%;
      margin: .25rem 0;
      padding: .75rem;
      border: 1px solid #ccc;
      border-radius: 6px;
      background: #fafafa;
      cursor: pointer;
      font-weight: bold;
    }
    .group button.selected { border-color: #3377ff; }
    #price { margin-top: 1rem; font-size: 1.2rem; }
  </style>
</head>
<body>
  <div id="configurator">
    <div class="viewer">
      <model-viewer
        id="model"
        src="Tradi_home2_draco2.glb"
        camera-controls
        auto-rotate
        background-color="#ffffff"
      ></model-viewer>
    </div>
    <div id="features">
      <div class="group" data-cat="bardage">
        <h4>Bardage extérieur</h4>
        <button data-color="#ffffff" data-cost="0">Blanc (inclus)</button>
        <button data-color="#8c6a4f" data-cost="799">Chêne foncé +799 €</button>
        <button data-color="#343a40" data-cost="899">Gris orage +899 €</button>
      </div>
      <div class="group" data-cat="menuiserie">
        <h4>Menuiserie alu</h4>
        <button data-color="#ffffff" data-cost="0">Blanc (inclus)</button>
        <button data-color="#2e2e2e" data-cost="2499">Anthracite +2499 €</button>
      </div>
      <div class="group" data-cat="murs">
        <h4>Peinture murs</h4>
        <button data-color="#ffffff" data-cost="0">Blanc (inclus)</button>
        <button data-color="#d6c9b1" data-cost="999">Beige Ares +999 €</button>
        <button data-color="#e5b79c" data-cost="1499">Ocre Mojave +1499 €</button>
      </div>
      <div class="group" data-cat="pergola">
        <h4>Pergola bioclimatique</h4>
        <button data-color="#ffffff" data-cost="8500">Blanc +8500 €</button>
        <button data-color="#2e2e2e" data-cost="9500">Anthracite +9500 €</button>
      </div>
      <div class="group" data-cat="toiture">
        <h4>Toiture tôle</h4>
        <button data-color="#243241" data-cost="0">Bleu ardoise (inclus)</button>
        <button data-color="#b0b0b0" data-cost="0">Gris acier (inclus)</button>
        <button data-color="#c0392b" data-cost="1800">Rouge hibiscus +1800 €</button>
      </div>
      <p id="price">Prix total : 170 000 €</p>
    </div>
  </div>

  <script type="module">
    console.log('DOM ready');
    const basePrice   = 170000;
    const modelViewer = document.getElementById('model');
    const priceEl     = document.getElementById('price');

    // Les vrais noms de matériaux (d'après ta console)
    const materialMap = {
      bardage:    ['bardage1','bardage2','bardage11','bardage22'],
      menuiserie: ['cadre_porte_fenetre.001'],
      murs:       [
        'murs','murs2','murs3','murs4','murs5',
        'murs.001','murs.002','murs.003','murs.004','murs.005','murs.006'
      ],
      pergola:    [
        'pergola1','pergola2','pergola3','pergola4','pergola5','pergola6',
        'volets_pergola','volet_pergola.001'
      ],
      toiture:    ['toit1','toit2','toit3','toit4']
    };

    function hexToRGBA(hex){
      const v = parseInt(hex.slice(1),16);
      return [(v>>16&255)/255,(v>>8&255)/255,(v&255)/255,1];
    }

    const selection = {};
    modelViewer.addEventListener('load', ()=>{
      console.log('model loaded');
      const mats = modelViewer.model.materials;

      document.querySelectorAll('.group').forEach(group=>{
        const cat = group.dataset.cat;
        group.querySelectorAll('button').forEach(btn=>{
          btn.addEventListener('click',()=>{
            // visuel
            group.querySelectorAll('button').forEach(b=>b.classList.remove('selected'));
            btn.classList.add('selected');
            // prix
            selection[cat] = Number(btn.dataset.cost);
            const total = Object.values(selection).reduce((a,b)=>a+b, basePrice);
            priceEl.textContent = `Prix total : ${total.toLocaleString()} €`;
            // couleur
            const rgba = hexToRGBA(btn.dataset.color);
            (materialMap[cat]||[]).forEach(name=>{
              const mat = mats.find(m=> m.name === name);
              if (mat) {
                mat.pbrMetallicRoughness.setBaseColorFactor(rgba);
              } else {
                console.warn(`❌ matériau '${name}' pas trouvé`);
              }
            });
          });
        });
        // appliqué par défaut : premier bouton
        group.querySelector('button').click();
      });
    });
  </script>
</body>
</html>
