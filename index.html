<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Configurateur Tradi’home</title>
  <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>
  <style>
    body {
      margin: 0;
      font-family: sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      background: #fafafa;
    }
    main {
      display: flex;
      width: 100%;
      max-width: 1400px;
      padding: 20px;
      box-sizing: border-box;
    }
    model-viewer {
      flex: 1;
      height: 600px;
      background-color: #e0e0e0;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.15);
    }
    .options {
      width: 300px;
      margin-left: 20px;
    }
    .options h2 {
      margin-top: 0;
    }
    .options button {
      display: block;
      width: 100%;
      margin: 8px 0;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 4px;
      background: white;
      cursor: pointer;
      text-align: left;
    }
    .options button.active {
      border-color: #0078d4;
      background: #e6f0fa;
    }
    .total {
      margin: 20px 0;
      font-size: 1.2em;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <h1>Configurateur Tradi’home</h1>
  <main>
    <!-- 1. Le viewer qui charge le modèle glTF embarqué -->
    <model-viewer
      id="model"
      src="TRADI22.gltf"
      camera-controls
      auto-rotate
      reveal
      ar
      background-color="#f0f0f0">
    </model-viewer>

    <!-- 2. La colonne d’options -->
    <div class="options">
      <h2>Bardage extérieur</h2>
      <button data-material-index="25" data-color="[1,1,1]">Blanc inclus</button>
      <button data-material-index="25" data-color="[0.8,0.6,0.4]">Chêne clair +0 €</button>
      <button data-material-index="26" data-color="[0.2,0.2,0.2]">Anthracite fixe +0 €</button>

      <h2>Peinture murs</h2>
      <button data-material-index="0" data-color="[1,1,1]">Blanc +0 €</button>
      <button data-material-index="1" data-color="[0.95,0.85,0.8]">Beige Wes +999 €</button>
      <button data-material-index="2" data-color="[0.9,0.7,0.5]">Ocre Mojave +1 499 €</button>

      <h2>Menuiserie alu & volets</h2>
      <button data-material-index="6" data-color="[1,1,1]">Blanc +0 €</button>
      <button data-material-index="5" data-color="[0.2,0.2,0.2]">Anthracite +2 499 €</button>

      <h2>Pergola bioclimatique + volets</h2>
      <button data-material-index="27" data-color="[1,1,1]">Blanc +8 500 €</button>
      <button data-material-index="28" data-color="[0.2,0.2,0.2]">Anthracite +9 500 €</button>

      <div class="total">Prix total : <span id="price">0 €</span></div>
    </div>
  </main>

  <script>
    (function() {
      const mv = document.querySelector('#model');
      const buttons = Array.from(document.querySelectorAll('.options button'));
      const priceEl = document.getElementById('price');
      let total = 0;

      // tarifs associés à chaque bouton (ordre identique)
      const tarifs = {
        // material-index : price delta
        25: {0: 0, 1: 0, 2: 0},   // bardage (indexes 25 & 26 partagés ci-dessous)
        26: {0: 0, 1: 0, 2: 0},
        0:  {0: 0, 1: 999, 2: 1499},
        1:  {0: 0, 1: 999, 2: 1499},
        2:  {0: 0, 1: 999, 2: 1499},
        5:  {0: 0, 1: 2499},
        6:  {0: 0, 1: 2499},
        27: {0: 0, 1: 8500},
        28: {0: 0, 1: 8500},
        29: {0: 0, 1: 9500},
        30: {0: 0, 1: 9500}
      };

      // quand le modèle est prêt, on active les boutons
      mv.addEventListener('load', () => {
        console.log('Modèle chargé. Matériaux disponibles :');
        Object.entries(mv.model.materials).forEach(([idx, mat]) => {
          console.log(idx, '→', mat.name);
        });

        // initialiser la première option de chaque groupe
        const groups = {};
        buttons.forEach(btn => {
          const idx = btn.dataset.materialIndex;
          if (!groups[idx]) {
            btn.classList.add('active');
            groups[idx] = btn;
            // appliquer sa couleur
            applyColor(idx, JSON.parse(btn.dataset.color));
            // ajouter son prix
            total += tarifs[idx][0] || 0;
          }
          // écouter les clics
          btn.addEventListener('click', () => {
            // désactiver l’autre du même material-index
            buttons.filter(b => b.dataset.materialIndex === idx)
                   .forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            // recolorer
            applyColor(idx, JSON.parse(btn.dataset.color));
            // recalculer prix
            recalcPrice();
          });
        });
        priceEl.textContent = total + ' €';
      });

      function applyColor(materialIndex, rgbArray) {
        const mat = mv.model.materials[materialIndex];
        if (mat) {
          mat.pbrMetallicRoughness.setBaseColorFactor([...rgbArray, 1]);
        } else {
          console.warn(`Matériau ${materialIndex} introuvable`);
        }
      }

      function recalcPrice() {
        total = 0;
        buttons.filter(b => b.classList.contains('active'))
               .forEach(b => {
                 const idx = b.dataset.materialIndex;
                 const group = buttons.filter(x => x.dataset.materialIndex === idx);
                 const selIndex = group.indexOf(b);
                 total += tarifs[idx][selIndex] || 0;
               });
        priceEl.textContent = total + ' €';
      }
    })();
  </script>
</body>
</html>
