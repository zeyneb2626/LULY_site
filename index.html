<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Configurateur Tradi'home</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <script type="module"
    src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js">
  </script>
  <style>
    body {
      margin:0;
      font-family:sans-serif;
      display:flex;
      flex-direction:column;
      align-items:center;
      padding:1rem;
    }
    #configurator {
      display:flex;
      width:100%;
      max-width:1200px;
    }
    .viewer { flex:1; margin-right:1rem }
    model-viewer {
      width:100%; height:600px; background:#f0f0f0;
    }
    #features { flex:0 0 300px; }
    .group { margin-bottom:1rem; }
    .group h4 { margin:0 0 .5rem; }
    .group button {
      display:block;
      width:100%;
      padding:.5rem;
      margin-bottom:.25rem;
      border:1px solid #ccc;
      background:#fff;
      text-align:left;
      cursor:pointer;
    }
    .group button.selected {
      border-color:#007bff;
      background:#e7f1ff;
    }
    #price {
      font-weight:bold;
      margin-top:1rem;
      text-align:right;
      width:100%; max-width:1200px;
    }
  </style>
</head>
<body>

<div id="configurator">
  <div class="viewer">
    <model-viewer
      id="model"
      src="TRADI2.glb"
      camera-controls
      auto-rotate
      background-color="#ffffff">
    </model-viewer>
  </div>
  <div id="features">

    <div class="group" data-cat="bardage">
      <h4>Bardage extÃ©rieur</h4>
      <button data-color="#ffffff" data-cost="0">Blanc inclus</button>
      <button data-color="#deb887" data-cost="0">ChÃªne clair +0 â‚¬</button>
      <button data-color="#333333" data-cost="0">Anthracite fixe +0 â‚¬</button>
    </div>

    <div class="group" data-cat="murs">
      <h4>Peinture murs</h4>
      <button data-color="#ffffff" data-cost="0">Blanc +0 â‚¬</button>
      <button data-color="#f5f5dc" data-cost="999">Beige Wes +999 â‚¬</button>
      <button data-color="#cd853f" data-cost="1499">Ocre Mojave +1 499 â‚¬</button>
    </div>

    <div class="group" data-cat="menuiserie">
      <h4>Menuiserie alu & volets</h4>
      <button data-color="#ffffff" data-cost="0">Blanc +0 â‚¬</button>
      <button data-color="#333333" data-cost="2499">Anthracite +2 499 â‚¬</button>
    </div>

    <div class="group" data-cat="pergolat">
      <h4>Pergola + volets</h4>
      <button data-color="#ffffff" data-cost="8500">Blanc +8 500 â‚¬</button>
      <button data-color="#333333" data-cost="9500">Anthracite +9 500 â‚¬</button>
    </div>

  </div>
</div>

<p id="price">Prix total : 0 â‚¬</p>

<script>
(function(){
  const mv = document.getElementById('model');
  const priceEl = document.getElementById('price');

  // 1ï¸âƒ£ Quand le modÃ¨le est chargÃ©, on log la liste des mat (index â†’ mat.name)
  mv.addEventListener('load', ()=> {
    console.clear();
    console.log('model loaded');
    console.log('ðŸ”§ Materials in GLB: clÃ© interne â†’ mat.name');
    Object.entries(mv.model.materials)
      .forEach(([idx, m]) => console.log(idx, 'â†’', m.name));
  });

  // 2ï¸âƒ£ Les bons INDICES pour chaque catÃ©gorie (dâ€™aprÃ¨s tes screenshots)
  const materialIndices = {
    bardage:   [15, 16],            // poutrine01, poutrine02
    murs:      [0, 39, 78],         // Murs, Murs.001, Murs.002
    menuiserie:[   // encadrements, portes, volets
      7,46,85,  // encadrement et ses variantes
      2,41,80,  // cadre_porte_fenetre
      4,43,82,  // porte
      5,44,83   // Volets
    ],
    pergolat:  [26,66,106, 24,64,104]  // volet_pergola + poutres et variantes
  };

  // Convertit "#rrggbb" â†’ [r,g,b,a]
  function hexToFactor(h){
    const v = parseInt(h.slice(1),16);
    return [
      ((v>>16)&255)/255,
      ((v>>8)&255)/255,
      (v&255)/255,
      1
    ];
  }

  // Applique une couleur Ã  TOUTES les indices de la catÃ©gorie
  function applyColor(cat, hex){
    const list = materialIndices[cat] || [];
    const factor = hexToFactor(hex);
    list.forEach(i => {
      const mat = mv.model.materials[i];
      if(!mat){
        console.warn(`âš  Indice ${i} introuvable pour ${cat}`);
      } else {
        mat.pbrMetallicRoughness.setBaseColorFactor(factor);
      }
    });
  }

  // Met Ã  jour le prix total
  function updatePrice(){
    const total = Array.from(
      document.querySelectorAll('button.selected')
    ).reduce((sum,btn)=> sum + Number(btn.dataset.cost), 0);
    priceEl.textContent = 
      `Prix total : ${total.toLocaleString('fr-FR')} â‚¬`;
  }

  // 3ï¸âƒ£ On branche les UI
  document.querySelectorAll('#features .group').forEach(group=>{
    const cat = group.dataset.cat;
    group.querySelectorAll('button').forEach(btn=>{
      btn.addEventListener('click', ()=>{
        // UI
        group.querySelectorAll('button')
             .forEach(b=> b.classList.remove('selected'));
        btn.classList.add('selected');
        // Couleur
        applyColor(cat, btn.dataset.color);
        // Prix
        updatePrice();
      });
    });
  });

})();
</script>

</body>
</html>
