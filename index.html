<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Configurateur Tradi‚Äôhome</title>

  <!-- model-viewer -->
  <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>

  <style>
    body { margin:0; font-family: sans-serif; background:#f0f0f0; }
    #configurator { display:flex; max-width:1200px; margin:2rem auto; gap:2rem; }
    .viewer { flex:1; background:#fff; padding:1rem; border-radius:8px; box-shadow:0 2px 8px rgba(0,0,0,.1); }
    model-viewer { width:100%; height:600px; }
    #features { width:300px; display:flex; flex-direction:column; gap:1rem; }
    .group { background:#fff; padding:1rem; border-radius:8px; box-shadow:0 1px 4px rgba(0,0,0,.1); }
    .group h4 { margin:0 0 .5rem; font-size:1.1rem; }
    .group button { display:block; width:100%; padding:.6rem; margin:.25rem 0; border:1px solid #ccc; background:#fff; cursor:pointer; border-radius:4px; text-align:left; }
    .group button.selected { border-color:#007bff; background:rgba(0,123,255,.1); }
    #price { text-align:center; margin-top:1rem; font-size:1.2rem; }
    #listMats { margin:1rem auto; display:block; }
  </style>
</head>

<body>
  <div id="configurator">
    <!--  ‚û§ VISU  -->
    <div class="viewer">
      <model-viewer
        id="model"
        src="Tadi_home_draco3.glb"
        camera-controls
        auto-rotate
        background-color="#ffffff">
      </model-viewer>
      <button id="listMats">üìù Lister les mat√©riaux</button>
    </div>

    <!--  ‚û§ OPTIONS  -->
    <div id="features">
      <div class="group" data-cat="bardage">
        <h4>Bardage ext√©rieur</h4>
        <!-- √† remplir apr√®s avoir list√© les noms exacts -->
      </div>
      <div class="group" data-cat="menuiserie">
        <h4>Menuiserie alu</h4>
      </div>
      <div class="group" data-cat="murs">
        <h4>Peinture murs</h4>
      </div>
      <div class="group" data-cat="pergola">
        <h4>Pergola + volets</h4>
      </div>
      <div class="group" data-cat="toiture">
        <h4>T√¥les & toiture</h4>
      </div>

      <p id="price">Prix total : 170 000 ‚Ç¨</p>
    </div>
  </div>

  <script type="module">
    // 1) Permet de lister TOUS les noms de mat√©riaux dans la console
    const btnList = document.getElementById('listMats');
    const mv       = document.querySelector('model-viewer');

    btnList.addEventListener('click', () => {
      mv.modelReady
        .then(() => {
          const mats = mv.model.materials;
          console.log('üîß Liste exacte des mat√©riaux dans le GLB :');
          // affiche cl√© interne ‚Üí nom Blender
          Object.entries(mats).forEach(([key, mat]) => {
            console.log(key, '‚Üí', mat.name);
          });
        })
        .catch(e => console.error(e));
    });

    // 2) CONFIGURATEUR (√† compl√©ter apr√®s avoir r√©cup√©r√© vos noms)
    const basePrice   = 170000;
    const priceEl     = document.getElementById('price');
    const materialMap = {
      bardage:    [ /* 'bardage_1.001','bardage2.001' */ ],
      menuiserie: [ /* 'menuiserie1','menuiserie1.001', ‚Ä¶ */ ],
      murs:       [ /* 'murs','Murs.001','murs.001', ‚Ä¶ */ ],
      pergola:    [ /* 'pergola1','sol_pergola.001','volet_pergola.001', ‚Ä¶ */ ],
      toiture:    [ /* 'toit1','toit_contour.001', ‚Ä¶ */ ],
    };

    function hexToRGBA(hex) {
      const v = parseInt(hex.slice(1), 16);
      return [(v >> 16 & 255)/255, (v >> 8 & 255)/255, (v & 255)/255, 1];
    }

    const selection = {};

    mv.addEventListener('load', () => {
      const mats = mv.model.materials;

      document.querySelectorAll('.group').forEach(group => {
        const cat = group.dataset.cat;
        group.querySelectorAll('button').forEach(btn => {
          btn.addEventListener('click', () => {
            // visuel
            group.querySelectorAll('button').forEach(b => b.classList.remove('selected'));
            btn.classList.add('selected');
            // prix
            selection[cat] = Number(btn.dataset.cost);
            const total = Object.values(selection).reduce((a,b)=>a+b, basePrice);
            priceEl.textContent = `Prix total : ${total.toLocaleString()} ‚Ç¨`;
            // couleur
            const rgba = hexToRGBA(btn.dataset.color);
            materialMap[cat].forEach(name => {
              const m = mats[name];
              if (m) m.pbrMetallicRoughness.setBaseColorFactor(rgba);
              else  console.warn(`‚ùå mat√©riau '${name}' introuvable`);
            });
          });
        });
        // s√©lection par d√©faut
        const first = group.querySelector('button');
        if (first) first.click();
      });
    });
  </script>
</body>
</html>
